@*
    =============================================================================
    AI FITNESS & DÄ°YET PLANI OLUÅTURUCU - VIEW DOSYASI
    =============================================================================
    
    AÃ‡IKLAMA:
    Bu Razor view dosyasÄ±, yapay zeka destekli fitness ve diyet planÄ± oluÅŸturma
    sayfasÄ±nÄ±n gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼ tanÄ±mlar. KullanÄ±cÄ±dan form verileri alÄ±r ve AI tarafÄ±ndan
    oluÅŸturulan planÄ± gÃ¶sterir.
    
    YAPISI:
    1. FORM BÃ–LÃœMÃœ: Kilo, boy, yaÅŸ, vÃ¼cut tipi ve hedef bilgilerini alÄ±r
    2. SONUÃ‡ BÃ–LÃœMÃœ: AI'dan gelen planÄ± Markdown'dan HTML'e Ã§evirip gÃ¶sterir
    
    KULLANILAN TEKNOLOJÄ°LER:
    - ASP.NET Core Razor syntax (@model, @ViewBag, asp-for vb.)
    - Bootstrap 5 (grid sistemi, kartlar, formlar)
    - Bootstrap Icons (bi bi-* ikonlarÄ±)
    - Regex ile Markdown -> HTML dÃ¶nÃ¼ÅŸÃ¼mÃ¼
    
    MODEL:
    - AIFitnessPlanViewModel (kilo, boy, yaÅŸ, vÃ¼cut tipi, hedef)
    
    CONTROLLER:
    - AIFitnessController.GeneratePlan (GET ve POST)
    
    =============================================================================
*@

@* ViewModel'i tanÄ±mla - Bu sayfa AIFitnessPlanViewModel kullanÄ±r *@
@model FitnessCenterManagement.ViewModels.AIFitnessPlanViewModel

@* Sayfa baÅŸlÄ±ÄŸÄ±nÄ± ayarla - Layout'ta <title> tagÄ±nda kullanÄ±lÄ±r *@
@{
    ViewData["Title"] = "AI Fitness & Diyet PlanÄ± OluÅŸturucu";
}

@* ============================================ *@
@* ANA KONTEYNER                                *@
@* ============================================ *@
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            
            @* ============================================ *@
            @* ANA KART - Form ve sonuÃ§larÄ± iÃ§erir         *@
            @* ============================================ *@
            <div class="card shadow-lg border-0">
                
                @* Kart baÅŸlÄ±ÄŸÄ± - Gradient arka plan *@
                <div class="card-header text-white py-3" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <h4 class="mb-0">
                        <i class="bi bi-robot"></i> ğŸ¤– AI Fitness & Diyet PlanÄ± OluÅŸturucu
                    </h4>
                    <small class="opacity-75">Yapay zeka destekli kiÅŸiselleÅŸtirilmiÅŸ plan</small>
                </div>
                
                <div class="card-body p-4">
                    
                    @* Bilgi kutusu - KullanÄ±cÄ±ya yÃ¶nerge *@
                    <div class="alert alert-info border-0">
                        <i class="bi bi-lightbulb"></i> Bilgilerinizi girin ve yapay zeka size Ã¶zel bir fitness ve diyet planÄ± oluÅŸtursun.
                    </div>
                    
                    @* ============================================ *@
                    @* FORM BÃ–LÃœMÃœ                                  *@
                    @* ============================================ *@
                    @* asp-action: Form POST edildiÄŸinde hangi action'a gideceÄŸini belirtir *@
                    <form asp-action="GeneratePlan" method="post">
                        
                        @* Model doÄŸrulama hatalarÄ±nÄ± gÃ¶ster *@
                        <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>
                        
                        @* ----- SATIR 1: Kilo ve Boy ----- *@
                        <div class="row">
                            @* Kilo alanÄ± *@
                            <div class="col-md-6 mb-3">
                                <label asp-for="Weight" class="form-label fw-bold">
                                    <i class="bi bi-speedometer2"></i> Kilo
                                </label>
                                <div class="input-group">
                                    @* asp-for: Model property'sine baÄŸlar (two-way binding) *@
                                    <input asp-for="Weight" class="form-control form-control-lg" type="number" step="0.1" placeholder="70" />
                                    <span class="input-group-text">kg</span>
                                </div>
                                @* DoÄŸrulama hatasÄ± mesajÄ± *@
                                <span asp-validation-for="Weight" class="text-danger small"></span>
                            </div>
                            
                            @* Boy alanÄ± *@
                            <div class="col-md-6 mb-3">
                                <label asp-for="Height" class="form-label fw-bold">
                                    <i class="bi bi-arrows-vertical"></i> Boy
                                </label>
                                <div class="input-group">
                                    <input asp-for="Height" class="form-control form-control-lg" type="number" step="0.1" placeholder="175" />
                                    <span class="input-group-text">cm</span>
                                </div>
                                <span asp-validation-for="Height" class="text-danger small"></span>
                            </div>
                        </div>
                        
                        @* ----- SATIR 2: YaÅŸ ve VÃ¼cut Tipi ----- *@
                        <div class="row">
                            @* YaÅŸ alanÄ± (isteÄŸe baÄŸlÄ±) *@
                            <div class="col-md-6 mb-3">
                                <label asp-for="Age" class="form-label fw-bold">
                                    <i class="bi bi-calendar3"></i> YaÅŸ
                                </label>
                                <input asp-for="Age" class="form-control form-control-lg" type="number" placeholder="25" />
                                <span asp-validation-for="Age" class="text-danger small"></span>
                            </div>
                            
                            @* VÃ¼cut tipi seÃ§imi (isteÄŸe baÄŸlÄ±) *@
                            <div class="col-md-6 mb-3">
                                <label asp-for="BodyType" class="form-label fw-bold">
                                    <i class="bi bi-person-standing"></i> VÃ¼cut Tipi
                                </label>
                                <select asp-for="BodyType" class="form-select form-select-lg">
                                    <option value="">-- SeÃ§iniz --</option>
                                    <option value="Ektomorf (Ä°nce yapÄ±lÄ±)">ğŸ¦´ Ektomorf (Ä°nce yapÄ±lÄ±)</option>
                                    <option value="Mezomorf (Atletik yapÄ±lÄ±)">ğŸ’ª Mezomorf (Atletik yapÄ±lÄ±)</option>
                                    <option value="Endomorf (GeniÅŸ yapÄ±lÄ±)">ğŸ» Endomorf (GeniÅŸ yapÄ±lÄ±)</option>
                                </select>
                            </div>
                        </div>
                        
                        @* ----- SATIR 3: Fitness Hedefi ----- *@
                        <div class="mb-4">
                            <label asp-for="Goal" class="form-label fw-bold">
                                <i class="bi bi-bullseye"></i> Fitness Hedefi
                            </label>
                            <select asp-for="Goal" class="form-select form-select-lg">
                                <option value="Weight Loss">ğŸ”¥ Kilo Verme</option>
                                <option value="Muscle Gain">ğŸ’ª Kas Kazanma</option>
                                <option value="Maintenance" selected>âš–ï¸ Kiloyu Koruma</option>
                                <option value="General Fitness">ğŸƒ Genel Fitness</option>
                            </select>
                            <span asp-validation-for="Goal" class="text-danger small"></span>
                        </div>
                        
                        @* ----- GÃ¶nder Butonu ----- *@
                        <div class="text-center">
                            <button type="submit" class="btn btn-lg px-5 py-3 text-white" 
                                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <i class="bi bi-magic"></i> âœ¨ PlanÄ±mÄ± OluÅŸtur
                            </button>
                        </div>
                    </form>
                    
                    @* ============================================ *@
                    @* SONUÃ‡ BÃ–LÃœMÃœ - AI'dan gelen plan            *@
                    @* ============================================ *@
                    @* ViewBag.GeneratedPlan doluysa sonucu gÃ¶ster *@
                    @if (ViewBag.GeneratedPlan != null)
                    {
                        <hr class="my-5">
                        
                        <div class="card border-0 shadow-lg">
                            @* SonuÃ§ kartÄ± baÅŸlÄ±ÄŸÄ± *@
                            <div class="card-header text-white py-3" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                                <h5 class="mb-0"><i class="bi bi-stars"></i> ğŸ¯ KiÅŸiselleÅŸtirilmiÅŸ PlanÄ±nÄ±z</h5>
                            </div>
                            <div class="card-body p-4">
                                
                                @* Plan iÃ§eriÄŸi - Markdown'dan HTML'e dÃ¶nÃ¼ÅŸtÃ¼rÃ¼lÃ¼r *@
                                <div class="plan-content" id="planContent">
                                    @{
                                        // AI'dan gelen Markdown formatÄ±ndaki planÄ± al
                                        string planHtml = ViewBag.GeneratedPlan.ToString();
                                        
                                        // ============================================
                                        // MARKDOWN -> HTML DÃ–NÃœÅÃœMÃœ
                                        // Regex kullanarak Markdown formatÄ±nÄ± HTML'e Ã§eviriyoruz
                                        // ============================================
                                        
                                        // #### BaÅŸlÄ±k 4 -> <h6> (en kÃ¼Ã§Ã¼k baÅŸlÄ±k)
                                        planHtml = System.Text.RegularExpressions.Regex.Replace(planHtml, @"^#### (.+)$", "<h6 class='text-info mt-3 mb-2'><i class='bi bi-dot'></i> $1</h6>", System.Text.RegularExpressions.RegexOptions.Multiline);
                                        
                                        // ### BaÅŸlÄ±k 3 -> <h5>
                                        planHtml = System.Text.RegularExpressions.Regex.Replace(planHtml, @"^### (.+)$", "<h5 class='text-primary mt-4 mb-3'><i class='bi bi-chevron-right'></i> $1</h5>", System.Text.RegularExpressions.RegexOptions.Multiline);
                                        
                                        // ## BaÅŸlÄ±k 2 -> <h4> (ana bÃ¶lÃ¼m baÅŸlÄ±klarÄ±)
                                        planHtml = System.Text.RegularExpressions.Regex.Replace(planHtml, @"^## (.+)$", "<h4 class='section-title'><i class='bi bi-star-fill'></i> $1</h4>", System.Text.RegularExpressions.RegexOptions.Multiline);
                                        
                                        // # BaÅŸlÄ±k 1 -> <h3>
                                        planHtml = System.Text.RegularExpressions.Regex.Replace(planHtml, @"^# (.+)$", "<h3 class='text-dark mt-4 mb-3'>$1</h3>", System.Text.RegularExpressions.RegexOptions.Multiline);
                                        
                                        // Tablo ayraÃ§ satÄ±rlarÄ±nÄ± kaldÄ±r (|---|---|)
                                        planHtml = System.Text.RegularExpressions.Regex.Replace(planHtml, @"^\|[-:\s|]+\|$", "", System.Text.RegularExpressions.RegexOptions.Multiline);
                                        
                                        // Tablo satÄ±rlarÄ±nÄ± div'e Ã§evir
                                        planHtml = System.Text.RegularExpressions.Regex.Replace(planHtml, @"^\| (.+) \|$", "<div class='table-row'>$1</div>", System.Text.RegularExpressions.RegexOptions.Multiline);
                                        
                                        // **kalÄ±n** -> <strong>
                                        planHtml = System.Text.RegularExpressions.Regex.Replace(planHtml, @"\*\*(.+?)\*\*", "<strong>$1</strong>");
                                        
                                        // *italik* -> <em>
                                        planHtml = System.Text.RegularExpressions.Regex.Replace(planHtml, @"\*(.+?)\*", "<em>$1</em>");
                                        
                                        // NumaralÄ± liste: 1. madde -> badge'li div
                                        planHtml = System.Text.RegularExpressions.Regex.Replace(planHtml, @"^(\d+)\. (.+)$", "<div class='numbered-item'><span class='num-badge'>$1</span><span class='num-text'>$2</span></div>", System.Text.RegularExpressions.RegexOptions.Multiline);
                                        
                                        // Madde iÅŸaretli liste: - madde -> ikonlu div
                                        planHtml = System.Text.RegularExpressions.Regex.Replace(planHtml, @"^- (.+)$", "<div class='list-item'><i class='bi bi-check-circle-fill text-success'></i> $1</div>", System.Text.RegularExpressions.RegexOptions.Multiline);
                                        
                                        // Yatay Ã§izgi: --- -> <hr>
                                        planHtml = System.Text.RegularExpressions.Regex.Replace(planHtml, @"^---+$", "<hr class='my-4'>", System.Text.RegularExpressions.RegexOptions.Multiline);
                                        
                                        // Paragraf ayrÄ±mlarÄ±
                                        planHtml = planHtml.Replace("\n\n", "</p><p class='mb-2'>");
                                        planHtml = "<p class='mb-2'>" + planHtml + "</p>";
                                    }
                                    @* HTML olarak render et (XSS riski olmadÄ±ÄŸÄ±ndan gÃ¼venli) *@
                                    @Html.Raw(planHtml)
                                </div>
                                
                                @* UyarÄ± mesajÄ± *@
                                <div class="alert alert-warning mt-4 border-0">
                                    <i class="bi bi-exclamation-triangle"></i> <strong>Ã–nemli:</strong> Bu plan yapay zeka tarafÄ±ndan oluÅŸturulmuÅŸtur. Yeni bir programa baÅŸlamadan Ã¶nce saÄŸlÄ±k uzmanÄ±na danÄ±ÅŸÄ±n.
                                </div>
                                
                                @* Aksiyon butonlarÄ± *@
                                <div class="d-flex justify-content-center gap-3 mt-4">
                                    @* YazdÄ±r butonu - window.print() JavaScript fonksiyonunu Ã§aÄŸÄ±rÄ±r *@
                                    <button class="btn btn-success btn-lg" onclick="window.print()">
                                        <i class="bi bi-printer"></i> YazdÄ±r
                                    </button>
                                    @* Yeni plan oluÅŸtur - GET isteÄŸi yaparak formu temizler *@
                                    <a asp-action="GeneratePlan" class="btn btn-outline-secondary btn-lg">
                                        <i class="bi bi-arrow-clockwise"></i> Yeni Plan
                                    </a>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@* ============================================ *@
@* SCRIPTS SECTION                              *@
@* Form doÄŸrulama iÃ§in gerekli scriptler        *@
@* ============================================ *@
@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}

@* ============================================ *@
@* STYLE SECTION                                *@
@* Sayfa Ã¶zel CSS stilleri                      *@
@* ============================================ *@
<style>
    /* Plan iÃ§eriÄŸi genel stilleri */
    .plan-content {
        line-height: 1.8;      /* SatÄ±r yÃ¼ksekliÄŸi - okunabilirlik iÃ§in */
        font-size: 1rem;       /* Temel font boyutu */
    }
    
    .plan-content p {
        margin-bottom: 0.5rem;
    }
    
    /* Ana bÃ¶lÃ¼m baÅŸlÄ±klarÄ± iÃ§in gradient stil */
    .section-title {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        margin-top: 25px;
        margin-bottom: 15px;
        font-size: 1.1rem;
    }
    
    .section-title i {
        margin-right: 8px;
    }
    
    /* Madde iÅŸaretli liste Ã¶ÄŸeleri iÃ§in stil */
    .list-item {
        padding: 8px 15px;
        margin: 5px 0;
        background: #f8f9fa;           /* AÃ§Ä±k gri arka plan */
        border-radius: 6px;
        border-left: 3px solid #28a745; /* YeÅŸil sol kenarlÄ±k */
    }
    
    .list-item i {
        margin-right: 10px;
    }
    
    /* NumaralÄ± liste Ã¶ÄŸeleri iÃ§in stil */
    .numbered-item {
        display: flex;
        align-items: flex-start;
        padding: 12px 15px;
        margin: 8px 0;
        background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
        border-radius: 8px;
        border-left: 4px solid #667eea; /* Mor sol kenarlÄ±k */
    }
    
    /* Numara badge'i (yuvarlak iÃ§inde numara) */
    .num-badge {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        width: 28px;
        height: 28px;
        border-radius: 50%;            /* Tam yuvarlak */
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 0.85rem;
        margin-right: 12px;
        flex-shrink: 0;                /* KÃ¼Ã§Ã¼lmesini engelle */
    }
    
    .num-text {
        flex: 1;
    }
    
    /* Tablo satÄ±rlarÄ± iÃ§in stil */
    .table-row {
        background: #f8f9fa;
        padding: 10px 15px;
        margin: 3px 0;
        border-radius: 6px;
        border-left: 3px solid #667eea;
        font-size: 0.95rem;
    }
    
    /* Tablo stilleri */
    .plan-content .table {
        margin: 15px 0;
        font-size: 0.95rem;
    }
    
    .plan-content .table th {
        white-space: nowrap;           /* BaÅŸlÄ±klar tek satÄ±rda kalsÄ±n */
    }
    
    .plan-content .table td {
        vertical-align: middle;
    }
    
    /* Alt baÅŸlÄ±klar iÃ§in stil */
    .plan-content h5 {
        color: #667eea;
        border-bottom: 2px dashed #e0e0e0;
        padding-bottom: 8px;
    }
    
    .plan-content h6 {
        color: #17a2b8;
    }
    
    /* Kartlar iÃ§in yuvarlak kÃ¶ÅŸeler */
    .card {
        border-radius: 15px;
        overflow: hidden;
    }
    
    /* Form elemanlarÄ± odaklandÄ±ÄŸÄ±nda mor kenarlÄ±k */
    .form-control:focus, .form-select:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }
    
    /* YazdÄ±rma modu iÃ§in stiller */
    @@media print {
        /* YazdÄ±rÄ±rken gizlenecek elemanlar */
        .btn, .alert-warning, nav, footer, form {
            display: none !important;
        }
        /* BaÅŸlÄ±k arka planÄ±nÄ± yazdÄ±rmada gÃ¶ster */
        .section-title {
            background: #333 !important;
            -webkit-print-color-adjust: exact;
        }
    }
</style>
